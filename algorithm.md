# Задание с пленками

## k-way merge
Задержки для ленты устанавливаются в файле latency.conf. Так как в задании есть ограничение по количеству чисел, которые мы можем хранить, для сортировки данных напленке я выбрал k-way merge сортировку. Входня лента читается по M/4 числа, сортируется в памяти, а потом записывается как временная лента. Далее все временные лентысливаются в одну - результат. Для случая когда в память не помещаются все числа надо как минимум 2 считывающие головки чтобы слить две ленты, поэтому я предположил, чтоколичество головок произвольное и ограничено только максимальным количеством открытых одновременно файловых дискрипторов. Количество временных лент тогда сотавляет 4N /M

## tape pool
Для мерджа лент я выбрал метод параллельного слияния лент в пуле с перезаписью лент, которые уже были слиты. Это является симуляцией реального параллельного слияния сиспользованием нескольких головк. В этом классе есть очередь задач - группа лент на слияние и лента на выход. Воркеры разбирают задачи, выполняют их и пушат в контенерс готовыми лентами, из которых потом формируются новые задачи. Все это происходт до момента пока не останется одна большая лента - выходная, а входные ленты помещаютсяв корзину. Так же когда для планирования задаче нужна лента для вывода она сначала она пытается взять уже использованную ленту, а если не получается создает новую (еслилимит по открытым файлам достигнут она ждет, пока не появится возможность создать новую ленту). С помоьщю такого алгоритма слияние происходит в разы быстрее слияниявсех лент сразу, но количество временных лент в самых плохих случаях будет  4N / M + 4N / (M * размер группы на слияние)

## Улучшения
В качестве улучшения алгоритма, которое я не успел сделать, я вижу использования не только переработки лент, но и их циклической записи. Для этого требовалось быпостроить новую абстракцию поверх абстракции ленты - подпоследовательность. Она бы указывала на ленту, на которой она записана, порядковый номер на ленте, указывающийначало подпоследовательности, и длинну подпоследовательности. В таком случае получилось бы сильно сократить количество используемых лент
